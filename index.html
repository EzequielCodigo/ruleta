<script>
    const URL_BASE = "https://cdn.jsdelivr.net/gh/EzequielCodigo/ruleta/"; 

    const options = {
        // Se cambió a PERSONAS para coincidir con tu carpeta de GitHub
        PERSONAS: ["Anciana", "Anciano", "Comerciante", "Hombre", "Joven", "Madre", "Mujer", "Niño", "Padre", "Portero Electrico", "una Joven"],
        OBSERVAR: ["Baston", "Cruz", "Desorden", "Jardin", "Juguetes", "Nada", "Profesional", "Rejas"],
        ACTITUD: ["APURADO", "CON VISITAS", "DEBATIDOR", "ENOJADO", "FERVIENTE", "MUCHO INTERÉS", "OCUPADO", "POCO INTERÉS", "RELAJADO", "SOBRADOR"],
        RELIGION: ["AGNÓSTICO", "ATEO", "BUDSTA", "CATÓLICO", "EVANGELÍCO", "EVOLUCIONISTA", "HIPIE", "JUDÍO", "MORMON", "NINGUNA", "Poco religioso", "SANTOS"]
    };

    const categorias = Object.keys(options);
    let isSpinning = false;
    let isResetMode = false;
    let results = ["", "", "", ""];
    let intervals = [null, null, null, null];
    const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3'), document.getElementById('reel4')];
    const btn = document.getElementById('spinBtn');
    const lever = document.getElementById('lever');

    function setReelContent(reel, val, carpeta) {
        const file = encodeURIComponent(val);
        reel.innerHTML = `<img src="${URL_BASE}${carpeta}/${file}.png" onerror="this.outerHTML='<span style=\'color:black;font-size:0.6rem\'>${val}</span>'">`;
    }

    function resetToZero() {
        const nombresCero = ["PERSONA_CERO", "OBSERVAR_CERO", "ACTITUD_CERO", "RELIGION_CERO"];
        // Aquí también se usa PERSONAS para la imagen inicial
        reels.forEach((reel, i) => setReelContent(reel, nombresCero[i], i === 0 ? "PERSONAS" : categorias[i] === "PERSONAS" ? "PERSONAS" : categorias[i] || "CERO"));
        
        // Corrección específica para la carga inicial de la carpeta CERO
        setReelContent(reels[0], "PERSONA_CERO", "CERO");
        setReelContent(reels[1], "OBSERVAR_CERO", "CERO");
        setReelContent(reels[2], "ACTITUD_CERO", "CERO");
        setReelContent(reels[3], "RELIGION_CERO", "CERO");

        btn.innerText = "GIRAR";
        btn.classList.remove('reset-mode');
        isResetMode = false;
    }

    resetToZero();

    btn.onclick = () => {
        if (isResetMode) { resetToZero(); return; }
        if (!isSpinning) {
            isSpinning = true;
            btn.innerText = "DETENER";
            lever.classList.add('lever-active');
            reels.forEach((reel, i) => {
                reel.classList.add('spinning');
                intervals[i] = setInterval(() => {
                    const list = options[categorias[i]];
                    setReelContent(reel, list[Math.floor(Math.random()*list.length)], categorias[i]);
                }, 50);
            });
        } else {
            isSpinning = false;
            btn.disabled = true;
            lever.classList.remove('lever-active');
            reels.forEach((reel, i) => {
                setTimeout(() => {
                    clearInterval(intervals[i]);
                    let finalVal = options[categorias[i]][Math.floor(Math.random()*options[categorias[i]].length)];
                    results[i] = finalVal;
                    reel.classList.remove('spinning');
                    setReelContent(reel, finalVal, categorias[i]);
                    if(i === 3) { 
                        btn.innerText = "REINICIAR"; 
                        btn.classList.add('reset-mode');
                        btn.disabled = false; 
                        isResetMode = true;
                    }
                }, i * 500);
            });
        }
    };
</script>
